apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - bulletin.dev.namespace.yaml
  - ../../base/django
  - ../../base/cronjob
  - secrets
  - bulletin.dev.ingress.yaml

nameSuffix: -dev
namespace: bulletin-dev
commonLabels:
  env: dev
  app: bulletin
  ns: bulletin-dev
commonAnnotations:
  pythonver: "2.7"

replicas:
 - name: bulletin-django
   count: 1

configMapGenerator:
  - name: bulletin-django-map
    literals:
    - AASHE_DRUPAL_COOKIE_DOMAIN=.aashe.org
    - AASHE_DRUPAL_KEY_DOMAIN=acupcc.aashe.org
    - AASHE_DRUPAL_URI=http://www.aashe.org/services/xmlrpc
    - AWS_STORAGE_BUCKET_NAME=aashe-bulletin-production
    - CONSTANT_CONTACT_FROM_EMAIL=bulletin@aashe.org
    - CONSTANT_CONTACT_REPLY_TO_EMAIL=bulletin@aashe.org
    - CONSTANT_CONTACT_USERNAME=aashelist
    - DEBUG=True
    - DMA_COOKIE_DOMAIN='it dies-ez'
    - DMA_COOKIE_SESSION='doesn't matter'
    - PORT=8080
    - PYTHONWARNINGS='ignore'

patches:
  - path: create.next.issue.patch.yaml
    target:
      group: batch
      version: v1beta1
      kind: CronJob
      name: bulletin-create-next-issue-cronjob

  - path: remove.index.patch.yaml
    target:
      group: batch
      version: v1beta1
      kind: CronJob
      name: bulletin-remove-index-cronjob

images:
- name: bulletin-django-image
  newName: gcr.io/aashe-migration/bulletin-image
  newTag: 1f0350eb-3f37-47ed-9405-827204a2314e
