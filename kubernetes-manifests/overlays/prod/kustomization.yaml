apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - bulletin.prod.namespace.yaml
  - ../../base/django
  - ../../base/cronjob
  - secrets
  - bulletin.prod.ingress.yaml
  - np.allow.egress.yaml
  - np.allow.http.yaml
  - np.deny.from.other.ns.yaml

nameSuffix: -prod
namespace: bulletin-prod
commonLabels:
  env: prod
  app: bulletin
  ns: bulletin-prod
commonAnnotations:
  pythonver: "2.7"

replicas:
 - name: bulletin-django
   count: 2

configMapGenerator:
  - name: bulletin-django-map
    literals:
    - AASHE_DRUPAL_COOKIE_DOMAIN=.aashe.org
    - AASHE_DRUPAL_KEY_DOMAIN=acupcc.aashe.org
    - AASHE_DRUPAL_URI=http://www.aashe.org/services/xmlrpc
    - AWS_STORAGE_BUCKET_NAME=aashe-bulletin-production
    - CONSTANT_CONTACT_FROM_EMAIL=bulletin@aashe.org
    - CONSTANT_CONTACT_REPLY_TO_EMAIL=bulletin@aashe.org
    - CONSTANT_CONTACT_USERNAME=aashelist
    - DEBUG=1
    - DMA_COOKIE_DOMAIN='it dies-ez'
    - DMA_COOKIE_SESSION='doesn't matter'
    - PORT=8080
    - PYTHONWARNINGS='ignore'

patches:
  - path: create.next.issue.patch.yaml
    target:
      group: batch
      version: v1beta1
      kind: CronJob
      name: bulletin-create-next-issue-cronjob

  - path: remove.index.patch.yaml
    target:
      group: batch
      version: v1beta1
      kind: CronJob
      name: bulletin-remove-index-cronjob

images:
- name: bulletin-django-image
  newName: gcr.io/aashe-migration/bulletin-image
  newTag: 43cb1d58-e708-48ec-86e8-88f3f031a97a
